q2.5Rt=mean(q2.5Rt),
q97.5Rt=mean(q97.5Rt)) %>%
#select() %>%
arrange(region,reopen) %>% View()
Rt_dat %>%
group_by(region,reopen) %>%
filter(medianRt==max(medianRt)) %>%
summarize(medianRt=mean(medianRt),
q2.5Rt=mean(q2.5Rt),
q97.5Rt=mean(q97.5Rt)) %>%
#select() %>%
arrange(region,reopen)
Rt_dat %>%
group_by(region,reopen) %>%
filter(medianRt==max(medianRt)) %>%
unique()
Rt_dat %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-12-30")) %>%
group_by(region,reopen) %>%
summarize(maxRt==max(medianRt),
q2.5Rt=mean(q2.5Rt),
q97.5Rt=mean(q97.5Rt)) %>%
arrange(region,reopen)
Rt_dat %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-12-30")) %>%
dplyr::group_by(region,reopen) %>%
dplyr::summarize(maxRt==max(medianRt),
q2.5Rt=mean(q2.5Rt),
q97.5Rt=mean(q97.5Rt)) %>%
arrange(region,reopen)
Rt_dat %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-12-30")) %>%
dplyr::group_by(region,reopen)
Rt_dat %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-12-30")) %>%
ungroup() %>%
dplyr::group_by(region,reopen) %>%
dplyr::summarize(maxRt==max(medianRt),
q2.5Rt=max(q2.5Rt),
q97.5Rt=max(q97.5Rt)) %>%
arrange(region,reopen)
Rt_dat %>% as.data.frame() %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-12-30")) %>%
ungroup() %>%
dplyr::group_by(region,reopen) %>%
dplyr::summarize(maxRt==max(medianRt),
q2.5Rt=max(q2.5Rt),
q97.5Rt=max(q97.5Rt)) %>%
arrange(region,reopen)
Rt_dat
Rt_dat$medianRt
Rt_dat %>% as.data.frame() %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-12-30")) %>%
ungroup() %>%
dplyr::group_by(region,reopen) %>%
dplyr::summarize(maxRt=max(medianRt),
q2.5Rt=max(q2.5Rt),
q97.5Rt=max(q97.5Rt)) %>%
arrange(region,reopen)
Rt_dat %>% as.data.frame() %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-12-30")) %>%
ungroup() %>%
dplyr::group_by(region,reopen) %>%
dplyr::summarize(maxRt=max(medianRt),
q2.5Rt=max(q2.5Rt),
q97.5Rt=max(q97.5Rt)) %>%
arrange(region,reopen) %>%
pivot_wider(names_from = "reopen", values_from=c("maxRt","q2.5Rt","q97.5Rt"))
Rt_dat %>% as.data.frame() %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-12-30")) %>%
ungroup() %>%
dplyr::group_by(region,reopen) %>%
dplyr::summarize(maxRt=max(medianRt),
q2.5Rt=max(q2.5Rt),
q97.5Rt=max(q97.5Rt)) %>%
arrange(region,reopen) %>%
pivot_wider(names_from = "reopen", values_from=c("maxRt","q2.5Rt","q97.5Rt"))%>% write.csv()
maxRt <- Rt_dat%>%
as.data.frame() %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-12-30")) %>%
ungroup() %>%
dplyr::group_by(region,reopen) %>%
dplyr::summarize(maxRt=max(medianRt),
q2.5Rt=max(q2.5Rt),
q97.5Rt=max(q97.5Rt)) %>%
arrange(region,reopen)
#### Calculate change in RT
baseRt <- Rt_dat%>%
group_by(region,reopen) %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-09-02")) %>%
summarize(medianRt_base=mean(medianRt),
q2.5Rt_base=mean(q2.5Rt),
q97.5Rt_base=mean(q97.5Rt)) %>%
#select() %>%
arrange(region,reopen)
maxRt <- merge(maxRt, baseRt, by=c("region","reopen"))
maxRt$medianRt_ratio <- maxRt$medianRt_max / maxRt$medianRt_base
###
maxRt <- Rt_dat%>%
as.data.frame() %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-12-30")) %>%
ungroup() %>%
dplyr::group_by(region,reopen) %>%
dplyr::summarize(maxRt=max(medianRt),
q2.5Rt=max(q2.5Rt),
q97.5Rt=max(q97.5Rt)) %>%
arrange(region,reopen)
maxRt
baseRt <- Rt_dat%>%
group_by(region,reopen) %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-09-02")) %>%
summarize(medianRt_base=mean(medianRt),
q2.5Rt_base=mean(q2.5Rt),
q97.5Rt_base=mean(q97.5Rt)) %>%
#select() %>%
arrange(region,reopen)
baseRt <- Rt_dat%>%
group_by(region,reopen) %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-09-02")) %>%
rename(medianRt_base=mean(medianRt),
q2.5Rt_base=mean(q2.5Rt),
q97.5Rt_base=mean(q97.5Rt)) %>%
#select() %>%
arrange(region,reopen)
Rt_dat
Rt_dat%>%
group_by(region,reopen) %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-09-02"))
baseRt <- Rt_dat%>%
group_by(region,reopen) %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-09-02")) %>%
dplyr::unique() %>%
dplyr::rename(medianRt_base=mean(medianRt),
q2.5Rt_base=mean(q2.5Rt),
q97.5Rt_base=mean(q97.5Rt)) %>%
#select() %>%
arrange(region,reopen)
#### Calculate change in RT
baseRt <- Rt_dat%>%
group_by(region,reopen) %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-09-02")) %>%
unique() %>%
dplyr::rename(medianRt_base=mean(medianRt),
q2.5Rt_base=mean(q2.5Rt),
q97.5Rt_base=mean(q97.5Rt)) %>%
#select() %>%
arrange(region,reopen)
Rt_dat%>%
group_by(region,reopen) %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-09-02")) %>%
unique()
baseRt <- Rt_dat%>%
group_by(region,reopen) %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-09-02")) %>%
unique() %>%
mutatse(medianRt_base=mean(medianRt),
q2.5Rt_base=mean(q2.5Rt),
q97.5Rt_base=mean(q97.5Rt)) %>%
#select() %>%
arrange(region,reopen)
#### Calculate change in RT
baseRt <- Rt_dat%>%
group_by(region,reopen) %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-09-02")) %>%
unique() %>%
mutate(medianRt_base=mean(medianRt),
q2.5Rt_base=mean(q2.5Rt),
q97.5Rt_base=mean(q97.5Rt)) %>%
#select() %>%
arrange(region,reopen)
baseRt
baseRt <- Rt_dat%>%
group_by(region,reopen) %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-09-02")) %>%
unique() %>%
mutate(medianRt_base=mean(medianRt),
q2.5Rt_base=mean(q2.5Rt),
q97.5Rt_base=mean(q97.5Rt)) %>%
select(region,reopen, medianRt_base, q2.5Rt_base, q97.5Rt_base)
maxRt <- merge(maxRt, baseRt, by=c("region","reopen"))
maxRt$medianRt_ratio <- maxRt$medianRt_max / maxRt$medianRt_base
maxRt <- Rt_dat%>%
as.data.frame() %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-12-30")) %>%
ungroup() %>%
dplyr::group_by(region,reopen) %>%
dplyr::summarize(medianRt_max=max(medianRt),
q2.5Rt_max=max(q2.5Rt),
q97.5Rt_max=max(q97.5Rt)) %>%
arrange(region,reopen)
baseRt <- Rt_dat%>%
group_by(region,reopen) %>%
filter(Date>=as.Date("2020-09-01") & Date <= as.Date("2020-09-02")) %>%
unique() %>%
mutate(medianRt_base=mean(medianRt),
q2.5Rt_base=mean(q2.5Rt),
q97.5Rt_base=mean(q97.5Rt)) %>%
select(region,reopen, medianRt_base, q2.5Rt_base, q97.5Rt_base)
maxRt <- merge(maxRt, baseRt, by=c("region","reopen"))
maxRt$medianRt_ratio <- maxRt$medianRt_max / maxRt$medianRt_base
#####
Book1 <- read_excel("C:/Users/mrm9534/Box/MR_archive/Book1.xlsx",  sheet = "Sheet5")
Rt_dat$region <- factor(Rt_dat$region, levels =c(1:11), labels = c(1:11))
Book1$region <- factor(Book1$region, levels =c(1:11), labels = c(1:11))
dat<- Book1%>% pivot_longer(cols=-c(region)) %>%
separate(name, into=c("reopen","sm","delay"), sep="__") %>%
mutate(reopen=tolower(reopen)) %>%
left_join(maxRt, by=c("region","reopen"))
ggplot(data=dat) +
geom_point(aes(x=medianRt_base, y=value, col=reopen))+
geom_smooth(aes(x=medianRt_base, y=value), se=FALSE)
ggplot(data=dat) +
geom_point(aes(x=medianRt_ratio, y=value, col=reopen))+
geom_smooth(aes(x=medianRt_ratio, y=value), se=FALSE)
ggplot(data=dat) +
geom_point(aes(x=medianRt_max, y=value, col=reopen))+
geom_smooth(aes(x=medianRt_max, y=value), se=FALSE)
ggplot(data=dat) +
geom_point(aes(x=q97.5Rt_max, y=value, col=reopen))+
geom_smooth(aes(x=q97.5Rt_max, y=value), se=FALSE)
ggplot(data=dat) +
geom_point(aes(x=q97.5Rt_max, y=value, col=reopen))+
geom_smooth(aes(x=q97.5Rt_max, y=value), se=FALSE) +
facet_wrap(~delay)
ggplot(data=dat) +
geom_point(aes(x=q97.5Rt_max, y=value, col=reopen))+
geom_smooth(aes(x=q97.5Rt_max, y=value, group=delay), se=FALSE)
ggplot(data=dat) +
geom_point(aes(x=medianRt_max, y=value, col=reopen))+
geom_smooth(aes(x=medianRt_max, y=value), se=FALSE)
ggplot(data=dat) +
geom_point(aes(x=medianRt_ratio, y=value, col=reopen))+
geom_smooth(aes(x=medianRt_ratio, y=value), se=FALSE)
maxRt$medianRt_ratio2 <- (maxRt$medianRt_max - maxRt$medianRt_base)/ ((maxRt$medianRt_max * maxRt$medianRt_base)/2)
Book1 <- read_excel("C:/Users/mrm9534/Box/MR_archive/Book1.xlsx",  sheet = "Sheet5")
Rt_dat$region <- factor(Rt_dat$region, levels =c(1:11), labels = c(1:11))
Book1$region <- factor(Book1$region, levels =c(1:11), labels = c(1:11))
dat<- Book1%>% pivot_longer(cols=-c(region)) %>%
separate(name, into=c("reopen","sm","delay"), sep="__") %>%
mutate(reopen=tolower(reopen)) %>%
left_join(maxRt, by=c("region","reopen"))
ggplot(data=dat) +
geom_point(aes(x=medianRt_ratio2, y=value, col=reopen))+
geom_smooth(aes(x=medianRt_ratio2, y=value), se=FALSE)
ggplot(data=dat) +
geom_point(aes(x=medianRt_max, y=value, col=reopen))+
geom_smooth(aes(x=medianRt_max, y=value), se=FALSE)+
theme_cowplot()
library(readr)
trajectoriesDat <- read_csv("C:/Users/mrm9534/Box/NU-malaria-team/projects/covid_chicago/cms_sim/simulation_output/20200825_IL_RR_baseline_0/trajectoriesDat.csv")
View(trajectoriesDat)
colnames(trajectoriesDat)
dat <- trajectoriesDat %>% select(time, run_num, sample_num, scen_num, `hosp_det_cumul_EMS-11` )
dat
dat <- trajectoriesDat %>% select(time,startdate, run_num, sample_num, scen_num, `hosp_det_cumul_EMS-11` )
dat <- trajectoriesDat %>% select(time,startdate,  scen_num, `hosp_det_cumul_EMS-11` )
dim(dat)
dat <- trajectoriesDat %>% select(time,startdate,  scen_num, `hosp_det_cumul_EMS-11` ) %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`)
dat
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
select(date,  scen_num, hosp_det_cumul ) %>%
mutate(new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul))
dat
Region11_pop =2716921
NMHpop= 315000
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
select(date,  scen_num, hosp_det_cumul ) %>%
mutate(hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul))
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
select(date,  scen_num, hosp_det_cumul ) %>%
mutate(hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul))
dat
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul)) %>%
select(date,  scen_num, new_hosp_det ) %>%
pivot_wider(names_from=scen_num, values_from=new_hosp_det)
dat
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
pivot_wider(names_from=scen_num, values_from=new_hosp_det)
dat
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
pivot_wider(names_from=scen_num, values_from=new_hosp_det)
dat
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
scen_num=paste0("scen_"),scen_num) %>%
select(date, time, scen_num, new_hosp_det ) %>%
pivot_wider(names_from=scen_num, values_from=new_hosp_det)
dat
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
scen_num=paste0("scen_",scen_num) %>%
select(date, time, scen_num, new_hosp_det ) %>%
pivot_wider(names_from=scen_num, values_from=new_hosp_det)
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
pivot_wider(names_from=scen_num, values_from=new_hosp_det)
dat
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
new_hosp_det =ifelse(time==0,0, new_hosp_det) %>%
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
pivot_wider(names_from=scen_num, values_from=new_hosp_det)
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
new_hosp_det =ifelse(time==0,0, new_hosp_det),
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
pivot_wider(names_from=scen_num, values_from=new_hosp_det)
dat
ggplot(data=dat) + geom_line(aes(x=time, y=scen_1 ))
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
new_hosp_det =ifelse(time==0,0, new_hosp_det),
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
ggplot() +
geom_line(aes(x=time, y=new_hosp_det, group=scen_num ))
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
new_hosp_det =ifelse(time==0,0, new_hosp_det),
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
pivot_wider(names_from=scen_num, values_from=new_hosp_det)
pplot<- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
new_hosp_det =ifelse(time==0,0, new_hosp_det),
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
ggplot() +
geom_line(aes(x=time, y=new_hosp_det, group=scen_num ))
pplot<- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
new_hosp_det =ifelse(time==0,0, new_hosp_det),
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
ggplot() +
geom_line(aes(x=time, y=new_hosp_det, group=scen_num ))
pplot
pplot<- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
new_hosp_det =ifelse(time==0,0, new_hosp_det),
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
ggplot() +
geom_line(aes(x=time, y=new_hosp_det, group=scen_num ), alpha=0.3)
pplot
pplot<- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
new_hosp_det =ifelse(time==0,0, new_hosp_det),
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
ggplot() + theme_minimal()+
geom_line(aes(x=time, y=new_hosp_det, group=scen_num ), alpha=0.3)
pplot
pplot<- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
new_hosp_det =ifelse(time==0,0, new_hosp_det),
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
ggplot() + theme_minimal()+geom_hline(yintercept=c(-Inf, Inf)) + geom_vline(xintercept=c(-Inf, Inf))+
geom_line(aes(x=time, y=new_hosp_det, group=scen_num ), alpha=0.3)
pplot
pplot<- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
new_hosp_det =ifelse(time==0,0, new_hosp_det),
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
ggplot() + theme_minimal()+geom_hline(yintercept=c(-Inf, Inf)) + geom_vline(xintercept=c(-Inf, Inf))+
geom_line(aes(x=time, y=new_hosp_det, group=scen_num ), alpha=0.3) +
labs(y="Daily new hospitalizations ", title="NMH catchment population", subtitle="")
pplot
savedir <- "C:/Users/mrm9534/Box/NU-malaria-team/projects/covid_chicago/cms_sim/for_hospital_model"
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
new_hosp_det =ifelse(time==0,0, new_hosp_det),
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
pivot_wider(names_from=scen_num, values_from=new_hosp_det)
write.csv(dat, file.path=savedir, row.names = FALSE)
write.csv(dat, path=savedir, row.names = FALSE)
write.csv(dat, file=file.path(savedir, "sample_trajectories_NMH"), row.names = FALSE)
write.csv(dat, file=file.path(savedir, "sample_trajectories_NMH.csv"), row.names = FALSE)
ggsave(pplot, path=file.path(savedir, "sample_trajectories_NMH.png"), drive="png")
ggsave(pplot, path=file.path(savedir, "sample_trajectories_NMH.png"), device="png")
ggsave(pplot,file="sample_trajectories_NMH.png", path=file.path(savedir), device="png")
ggsave(pplot,file="sample_trajectories_NMH.png", path=file.path(savedir), device="png", width=7, height=3)
ggsave(pplot,file="sample_trajectories_NMH.png", path=file.path(savedir), device="png", width=6, height=3)
head(dat)
View(dat)
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
new_hosp_det =ifelse(time==0,0, new_hosp_det),
new_hosp_det = round(new_hosp_det,0)
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
pivot_wider(names_from=scen_num, values_from=new_hosp_det)
dat <- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
new_hosp_det =ifelse(time==0,0, new_hosp_det),
new_hosp_det = round(new_hosp_det,0),
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
pivot_wider(names_from=scen_num, values_from=new_hosp_det)
pplot<- trajectoriesDat %>%
mutate( date = time+startdate) %>%
rename(hosp_det_cumul=`hosp_det_cumul_EMS-11`) %>%
mutate(time=round(time,0),
hosp_det_cumul =( hosp_det_cumul/Region11_pop)*NMHpop,
new_hosp_det = hosp_det_cumul - lag(hosp_det_cumul),
new_hosp_det =ifelse(time==0,0, new_hosp_det),
new_hosp_det = round(new_hosp_det,0),
scen_num=paste0("scen_",scen_num)) %>%
select(date, time, scen_num, new_hosp_det ) %>%
ggplot() + theme_minimal()+geom_hline(yintercept=c(-Inf, Inf)) + geom_vline(xintercept=c(-Inf, Inf))+
geom_line(aes(x=time, y=new_hosp_det, group=scen_num ), alpha=0.3) +
labs(y="Daily new hospitalizations ", title="NMH catchment population", subtitle="")
pplot
write.csv(dat, file=file.path(savedir, "sample_trajectories_NMH.csv"), row.names = FALSE)
ggsave(pplot,file="sample_trajectories_NMH.png", path=file.path(savedir), device="png", width=6, height=3)
savehistory("C:/Users/mrm9534/gitrepos/covid-chicago/Rfiles/hospital_model_sampleTrajectories.Rhistory")
